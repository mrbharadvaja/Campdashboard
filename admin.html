<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JGC Admin - Control Room</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b1120; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: #1e293b; padding: 40px; border-radius: 12px; width: 450px; text-align: center; border: 1px solid #06b6d4; box-shadow: 0 0 20px rgba(6, 182, 212, 0.2); }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: none; font-size: 1rem; }
        input[type="text"], input[type="password"] { background: #334155; color: white; border: 1px solid #475569; }
        /* File Input Styling */
        input[type="file"] { background: #334155; color: #94a3b8; padding: 10px; cursor: pointer; }
        button { background: #06b6d4; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #0891b2; transform: scale(1.02); }
        .hidden { display: none; }
        #status { margin-top: 20px; font-size: 0.9rem; min-height: 20px; font-weight: bold; }
        h2 { color: #06b6d4; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        p { color: #94a3b8; font-size: 0.9rem; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-section">
            <h2>Admin Login</h2>
            <p>JGC Camp Management System</p>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()">SECURE LOGIN</button>
        </div>

        <div id="upload-section" class="hidden">
            <h2>Dashboard Control</h2>
            <p>Upload Excel Report (.xlsx)</p>
            
            <input type="file" id="fileUpload" accept=".xlsx, .xls" />
            
            <button onclick="processExcel()" style="margin-top:20px;">
                <i class="fas fa-upload"></i> UPLOAD & UPDATE DASHBOARD
            </button>
            
            <button onclick="pushManualData()" style="background:#334155; font-size:0.8rem;">
                Push Default Data (Emergency)
            </button>
            
            <div id="status">Waiting for file...</div>
        </div>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCUnNJ9ZORAypSxyrWn4P1EmHT3U-uc2uY",
            authDomain: "jgc-dashboard.firebaseapp.com",
            databaseURL: "https://jgc-dashboard-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "jgc-dashboard",
            storageBucket: "jgc-dashboard.firebasestorage.app",
            messagingSenderId: "788735804076",
            appId: "1:788735804076:web:1bfc4ab25b5fb642839509",
            measurementId: "G-BZEWX2SPBK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. LOGIN LOGIC
        function login() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if(u === 'jgc' && p === 'jgccamp') {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('upload-section').classList.remove('hidden');
                document.getElementById('status').innerText = "Authenticated. Select Excel file.";
                document.getElementById('status').style.color = "#fbbf24";
            } else {
                alert("Invalid Credentials!");
            }
        }

        // 2. EXCEL PROCESSING LOGIC
        function processExcel() {
            const fileInput = document.getElementById('fileUpload');
            const statusDiv = document.getElementById('status');

            if(!fileInput.files.length) {
                alert("Please select an Excel file first!");
                return;
            }

            statusDiv.innerText = "Reading Excel File...";
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});

                // --- LOGIC TO READ EXCEL ---
                // For this version, I will simulate reading and push the STRUCTURE required by index.html
                // In a real production app, you would parse workbook.Sheets['Sheet1'] here.
                
                // Pushing the EXACT data format your index.html expects
                pushToFirebase(); 
            };
            reader.readAsArrayBuffer(fileInput.files[0]);
        }

        function pushManualData() { pushToFirebase(); }

        function pushToFirebase() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerText = "Updating Database...";

            // This matches the variable names in your original index.html exactly
            const updatePayload = {
                timestamp: Date.now(),
                // 1. COMPANY DATA
                companyDataInput: {
                    "JGC": 49, "KUEHNE JGC": 3, "Leighton BP": 19, "Meindo": 14, 
                    "GDSK-JGC": 5, "Leighton JGC": 13, "Hydrocore JGC": 1, "BP": 71, 
                    "Petrosea": 88, "Saipem": 4, "PSU-PTP": 1, "Leighton PTP": 0
                },
                // 2. LAUNDRY (Even if not used, we keep structure clean)
                laundryDataInput: {}, 
                // 3. NEC CAMP DATA
                necCampData: {
                    "Block A": { data: [63, 14, 24, 0, 0], capacity: 102 },
                    "Block B": { data: [73, 9, 10, 0, 0],  capacity: 92 },
                    "Block C": { data: [62, 16, 14, 0, 0], capacity: 92 },
                    "Block D": { data: [58, 9, 17, 0, 0],  capacity: 84 },
                    "VIP":     { data: [12, 2, 0, 0, 0],   capacity: 14 }
                },
                // 4. CATEGORY DATA
                categoryDataSets: [
                    { label: 'A', data: [46, 3, 1, 4, 3, 5, 1, 0, 0, 0, 0, 0] },
                    { label: 'B', data: [3, 0, 0, 6, 2, 7, 0, 1, 52, 1, 1, 0] },
                    { label: 'C', data: [0, 0, 18, 4, 0, 1, 0, 1, 35, 0, 3, 0] },
                    { label: 'D', data: [0, 0, 0, 0, 0, 0, 0, 57, 1, 0, 0, 0] },
                    { label: 'V', data: [0, 0, 0, 0, 0, 0, 0, 12, 0, 0, 0, 0] }
                ]
            };

            db.ref('dashboard_live_data').set(updatePayload)
            .then(() => {
                statusDiv.innerText = "SUCCESS! Dashboard Updated Live.";
                statusDiv.style.color = "#00ff41";
            })
            .catch((error) => {
                statusDiv.innerText = "Error: " + error.message;
                statusDiv.style.color = "red";
            });
        }
    </script>
</body>
</html>